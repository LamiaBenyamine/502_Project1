---
title: "502_Project1"
author: "Ming Cai & Lamia Benyamine"
date: "2024-10-06"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

# INTRODUCTION

There are many methods to approximate the probability of success, p,
from a Binomial random sample, however, not all have the same coverage
probabilities or average length of the confidence interval. This report
will review several different methods using R and compare the
performance of the confidence intervals for various sample sizes and
probabilities for these three properties:

-   The proportion of intervals that capture the true value

-   The proportion that miss above and proportion that miss below

-   The average length of the interval

We will use data collected from 1,00 random samples from a binomial
distribution where n varies from 15, 13, to 100 and p varies from 0.01
to 0.99 across each approximation method. The methods reviewed in this
report are: Wald interval Adjusted Wald interval Clopper-Pearson (exact)
interval Score interval Raw percentile interval using a parametric
bootstrap Bootstrap t interval using a parametric bootstrap

# SIMULATION METHODS

## Wald Interval
The formula of calculating Wald interval is:

$$
\hat{p} - z_{1-\frac{\alpha}{2}}\sqrt{\frac{\hat{p}(1-\hat{p})}{n}} < p < \hat{p} + z_{1-\frac{\alpha}{2}}\sqrt{\frac{\hat{p}(1-\hat{p})}{n}},
$$

where the $z_c$ denotes the $c$ quantile of the standard normal distribution. 

To calculate the Wald interval for $p$, we need to use sample's probability $\hat{p}$, sample size $n$ and the confidence level $1-\alpha$. The function of calculating Wald Interval is given below:

```{r}
WaldCI <- function(y, n, alpha = 0.05){
  p_hat = y/n  # Estimate of the probability of success
  # Return lower and upper bound of Wald CI
  c("wald ci lower" = p_hat - qnorm(1-alpha/2)*sqrt((p_hat*(1-p_hat))/n),
    "wald ci upper" = p_hat + qnorm(1-alpha/2)*sqrt((p_hat*(1-p_hat))/n))
}
```
We use $\alpha = 0.05$ as default in all calculation.

## Adjusted Wald interval
To overcome the poor performance of Wald interval, adjusted Wald interval was proposed. The formula of adjusted Wald interval is almost the same as Wald interval, except that we add 2 successes and 2 failures to the sample data set:

$$
\tilde{p} - z_{1-\frac{\alpha}{2}}\sqrt{\frac{\tilde{p}(1-\tilde{p})}{n}} < p < \tilde{p} + z_{1-\frac{\alpha}{2}}\sqrt{\frac{\tilde{p}(1-\tilde{p})}{n}},
$$

where $\tilde{p} = (Y+2)/(n+4)$.

The function of calculating adjusted Wald Interval is given below:

```{r}
AdjWaldCI <- function(y, n, alpha = 0.05){
  p_tilde = (y+2)/(n+4)  # Adjusted estimate of probability of success
  # Return lower and upper bound of Adjusted Wald CI
  c("adj wald ci lower" = p_tilde - qnorm(1-alpha/2)*sqrt((p_tilde*(1-p_tilde))/n),
    "adj wald ci upper" = p_tilde + qnorm(1-alpha/2)*sqrt((p_tilde*(1-p_tilde))/n))
}

## Clopper-Pearson (exact) interval
Clopper-Pearson interval is referred to as "exact" interval. This interval is guaranteed to have coverage probability of at least $1 - \alpha$ for every value of $p$. When $y = 1,2, \cdots , n - 1$, the confidence interval is:

$$
\left[ 1 + \frac{n-y+1}{yF_{2y,2(n-y+1),\frac{\alpha}{2}}} \right]^{-1} < p < \left[ 1 + \frac{n-y}{(y+1)F_{2(y+1),2(n-y),1-\frac{\alpha}{2}}} \right]^{-1},
$$

where the $F_{a,b,c}$ denotes the $c$ quantile from the F distribution with degrees of freedom $a$ and $b$. 

When $y = 0$, we set the interval to be $[0,0]$ and When $y = n$, we set the interval to be $[1,1]$. The function of calculating Clopper-Pearson interval is given below:

```{r}
ClopperPearsonCI <- function(y, n, alpha = 0.05){
  # Handle special cases where y is 0 or y equals n
  if (y==0){
    c("C-P interval lower" = 0, 
      "C-P interval upper" = 0)
    } else if (y==n){
      c("C-P interval lower" = 1, 
        "C-P interval upper" = 1)
    } else {
      # General case for Clopper-Pearson CI using F-distribution
  c("C-P interval lower" = 1 / (1 + ((n-y+1) / (y * qf(alpha/2, 2*y, 2*(n-y+1))))), 
    "C-P interval upper" = 1 / (1 + ((n-y) / ((y+1) * qf(1-(alpha/2), 2*(y+1), 2*(n-y))))))
    }
}
```
## Score interval

Score tests, and in particular their standard errors, are based on the
log-likelihood at the null hypothesis value of the parameter, whereas
Wald tests are based on the log-likelihood at the maximum likelihood
estimate.

```{r}
#example code block

```

## Raw percentile interval using a parametric bootstrap

This method uses the empirical 1 − α/2 quantile for the lower value and
α/2 quantile for the upper value as the confidence interval of the
bootstrap distribution. For a parametric bootstrap, we will resample the
data from a fitted curve, in this case, a binomial distribution.

## Bootstrap t interval using a parametric bootstrap

This method creates a ‘t-type’ statistic to use a pivot.

## Creation of data

We generated $N = 1000$ random samples from a binomial where sample size $n$ varies across 15, 30, to 100 and true proportion $p$ varies from 0.01 to 0.99 (15 total values of p). 

```{r}
# Set values
N <- 1000 # Number of random samples
n <- c(15, 30, 100) # Values of n
p <- seq(0.01, 0.99, length.out = 15) # Values of p
B <- 100 # Number of bootstrap resamples

# Function to generate random binomial sample data for each combination of n and p
GetData <- function(n_vals, p_vals, N = 1000) { 
  sample_data <- list()  # Initialize a list to store sample data
  for (n in n_vals) {
    for (p in p_vals) {
      samples <- rbinom(N, size = n, prob = p)  # Generate N binomial samples
      col_name <- paste0("n", n, "p", p)  # Create column name for the dataset
      sample_data[[col_name]] <- samples  # Store samples in the list
    }
  }
  return(sample_data)
}
sample_data <- GetData(n, p, N)

```


# RESULTS

# CONCLUSION
